<html>
<head>
    <title>Hands On Scala Native</title>
    <meta charset="utf-8">
    <!-- build:css(bower_components) assets/styles/libs.css -->
    <link rel="stylesheet" type="text/css" href="/reveal.js/css/reveal.css">
    <!-- <link rel="stylesheet" type="text/css" href="/reveal.js/css/theme/moon.css"> -->
    <link rel="stylesheet" type="text/css" href="/reveal.js/css/theme/solarized.css">
    <!-- <link rel="stylesheet" type="text/css" href="/highlight.js/src/styles/solarized-dark.css"> -->
    <link rel="stylesheet" type="text/css" href="/highlight.js/src/styles/solarized-light.css">
    <!-- endbuild -->

    <!-- build:css(tmp) assets/styles/app.css -->
    <link rel="stylesheet" type="text/css" href="/styles/main.css">
    <!-- endbuild -->
</head>
<body class="light">
  <div class="reveal">
    <div class="slides">

<section>
  <h2>Hands-on</h2>
  <h2>Scala-Native<h2>
</section>

<section>
  <h2>Presentation Plan</h2>
  <ul>
    <li>A</li>
    <li>A</li>
    <li>A</li>
  </ul>
</section>

<section>
<pre><code data-trim data-noescape>
┌[ 1.59 KiB/s ]─[ nbwmon-0.6 | interface: wlp4s0 ]─[ Received ]┐
│-              *                                              │
│-              *                                        *     │
│-              *   *                                    *     │
│-              *   *                                    *     │
│-              *   *            *                       *     │
└[ 0 B/s ]─────────────────────────────────────────────────────┘
┌[ 3.74 KiB/s ]─────────────────────────────────[ Transmitted ]┐
│-                               *                             │
│-              *                *                       *     │
│-              *   *            **                      *     │
│-              *   *   **      ****                 *   *    *│
│-              *   *   **** *  **** * ** * **   *   *  **    *│
└[ 0 B/s ]─────────────────────────────────────────────────────┘
┌[ Received ]──────────────────┐┌[ Transmitted ]───────────────┐
│Current:               384 B/s││Current:               564 B/s│
│Maximum:            1.59 KiB/s││Maximum:            3.74 KiB/s│
│Average:               113 B/s││Average:               164 B/s│
│Minimum:                 0 B/s││Minimum:                 0 B/s│
│Total:                3.65 GiB││Total:                2.88 GiB│
│                              ││                              │
└──────────────────────────────┘└──────────────────────────────┘
</code></pre>
<mark>https://github.com/causes-/nbwmon</mark>
</section>

<section>
https://git.io/vSMS7
</section>

<section>
<h4>System Setup</h4>

macOS:
<pre>brew install <mark>llvm bdw-gc</mark> ncurses</pre>

Ubuntu:
<pre>sudo apt-get install <mark>clang libgc-dev libunwind-dev</mark> libncurses-dev</pre>

Nix:
<pre>nix-shell .</pre>

</section>

<section>
<h4>Sbt Setup</h4>
project/plugins.sbt
<pre><code data-trim data-noescape>
addSbtPlugin(<mark>"org.scala-native" % "sbt-scala-native" % "0.1.0"</mark>)
</code></pre>

build.sbt
<pre><code data-trim data-noescape>
enablePlugins(<mark>ScalaNativePlugin</mark>)

scalaVersion := "2.11.8"
</code></pre>
</section>

<section>
  <section>
    <h1>DEMO</h1>
  </section>
  <section>
    <img src="out.gif" alt="nbwmon terminal demo">
  </section>
</section>

<section>
  <h2>Presentation Plan</h2>
  <ul>
    <li>A</li>
    <li>A</li>
    <li>A</li>
  </ul>
</section>


<section>
  <h4>Redraw Loop</h4>
<pre><code data-trim data-noescape>
def waitLoop(body: => Unit): Unit = {
    var timer  = 0L
    var redraw = false
    <mark>val tv: Ptr[timeval] = stackalloc[timeval]</mark>
    var key = 0
    while (key != 'q') {
      gettimeofday(tv, null)
      if (timer < tv.tv_sec) {
        timer = tv.tv_sec
        redraw = true
      }
      if (redraw) {
        body
        redraw = false
      }
      key = getch()
    }
  }
</code></pre>
</section>

<!-- == Slide 2 == -->
<section>
<h4>Interropt with C</h4>
<pre><code data-trim data-noescape>
import scalanative.native._

<mark>@extern</mark>
object posix {
  import posixh._
  def gettimeofday(tv: Ptr[timeval], tz: Ptr[timezone]): Unit = 
    <mark>extern</mark>
}

object posixh {
  type time_t      = CLong
  type suseconds_t = CLong
  type timeval     = <mark>CStruct2[time_t, suseconds_t]</mark>
  type timezone    = <mark>CStruct0</mark>

  implicit class timevalOps(val ptr: Ptr[timeval]) {
    def tv_sec: time_t       = <mark>!(ptr._1)</mark>
    def tv_usec: suseconds_t = <mark>!(ptr._2)</mark>
  }
}
</code></pre>
</section>

    </div>
  </div>

  <!-- build:js(bower_components) assets/scripts/libs.js -->

  <script src="/reveal.js/lib/js/head.min.js"></script>
  <script src="/reveal.js/js/reveal.js"></script>
  <!-- endbuild -->

  <!-- build:js(web) assets/scripts/app.js -->
  <script src="/app.js"></script>
  <!-- endbuild -->

</body>
</html>
