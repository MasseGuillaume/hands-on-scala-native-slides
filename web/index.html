<html>
<head>
    <title>Hands On Scala Native</title>
    <meta charset="utf-8">
    <!-- build:css(bower_components) assets/styles/libs.css -->
    <link rel="stylesheet" type="text/css" href="/reveal.js/css/reveal.css">
    <!-- <link rel="stylesheet" type="text/css" href="/reveal.js/css/theme/moon.css"> -->
    <link rel="stylesheet" type="text/css" href="/reveal.js/css/theme/solarized.css">
    <!-- <link rel="stylesheet" type="text/css" href="/highlight.js/src/styles/solarized-dark.css"> -->
    <link rel="stylesheet" type="text/css" href="/highlight.js/src/styles/solarized-light.css">
    <!-- endbuild -->

    <!-- build:css(tmp) assets/styles/app.css -->
    <link rel="stylesheet" type="text/css" href="/styles/main.css">
    <!-- endbuild -->
</head>
<body class="light">
  <div class="reveal">
    <div class="slides">

<!-- == Slide 1 == -->
<section>
  <h4>Redraw Loop</h4>
<pre><code data-trim data-noescape>
def waitLoop(body: => Unit): Unit = {
    var timer  = 0L
    var redraw = false
    <mark>val tv: Ptr[timeval] = stackalloc[timeval]</mark>
    var key = 0
    while (key != 'q') {
      gettimeofday(tv, null)
      if (timer < tv.tv_sec) {
        timer = tv.tv_sec
        redraw = true
      }
      if (redraw) {
        body
        redraw = false
      }
      key = getch()
    }









  }
</code></pre>
</section>

<!-- == Slide 2 == -->
<section>
<h4>Interropt with C</h4>
<pre><code data-trim data-noescape>
import scalanative.native._

<mark>@extern</mark>
object posix {
  import posixh._
  def gettimeofday(tv: Ptr[timeval], tz: Ptr[timezone]): Unit = 
    <mark>extern</mark>
}

object posixh {
  type time_t      = CLong
  type suseconds_t = CLong
  type timeval     = <mark>CStruct2[time_t, suseconds_t]</mark>
  type timezone    = <mark>CStruct0</mark>

  implicit class timevalOps(val ptr: Ptr[timeval]) {
    def tv_sec: time_t       = <mark>!(ptr._1)</mark>
    def tv_usec: suseconds_t = <mark>!(ptr._2)</mark>
  }
}
</code></pre>
</section>

    </div>
  </div>

  <!-- build:js(bower_components) assets/scripts/libs.js -->

  <script src="/reveal.js/lib/js/head.min.js"></script>
  <script src="/reveal.js/js/reveal.js"></script>
  <!-- endbuild -->

  <!-- build:js(web) assets/scripts/app.js -->
  <script src="/app.js"></script>
  <!-- endbuild -->

</body>
</html>
